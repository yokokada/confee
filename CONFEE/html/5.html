<!DOCTYPE html>
<html lang="jn">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>ÈÅéÂéª„É≠„Ç∞ÁîªÈù¢</title>
</head>
<body>
    <div class="wrap">
        <header>
            <div class="logo">
                <p>CONFEE</p>
            </div>
            <div class="hmenu">
                <a href="l"><img src="../img/4.png" alt=""></a>
            </div>
        </header>
        <main>
            <!-- Á©∫ÁôΩ -->
            <div class="mainmargin"> </div>
            <!-- ÈÅéÂéª„É≠„Ç∞„Çø„Ç§„Éà„É´ -->
            <div class="kakotitle">
                <p>ÁßÅ„ÅÆÊÑüÊÉÖ„ÅÆË®òÈå≤</p>
            </div>

            <!-- ‰∏¶„Å≥Êõø„Åà„Éú„Çø„É≥ -->
            <div class="kakobtn">
             <button id="f_change">‚ñºÊÑüÊÉÖ„Åß‰∏¶„Å≥Êõø„Åà </button>
             <button id="r_change">‚ñºÂè§„ÅÑÈ†Ü„Å´‰∏¶„Å≥Êõø„Åà</button>
            </div>
            <div id="container"></div>

            <!-- <div id="kakoview">
                <div class="kakodata">
                </div>
            </div> -->
            
            <!-- Á©∫ÁôΩ -->
            <div class="bottommargin"> </div>
        </main>
        <footer>
            <div class="fbox1">
                <a href="home.html"><img src="../img/1.png" alt=""></a>
            </div>
            <div class="fbox2">
                <a href="5.html"><img src="../img/2.png" alt=""></a>
            </div>
            <div class="fbox3">
                <a href="https://careality.jp/wheel-of-emotions/"><img src="../img/5.png" alt=""></a>
            </div>
            <div class="fbox3">
                <a href="3.html"><img src="../img/3.png" alt=""></a>
            </div>
        </footer>
    </div>
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
        apiKey: "AIzaSyBIAp77hJUMvb1lMxxib8eSGMmkGh8U-1g",
        authDomain: "confee-5aca7.firebaseapp.com",
        databaseURL : "https://confee-5aca7-default-rtdb.firebaseio.com",
        projectId: "confee-5aca7",
        storageBucket: "confee-5aca7.appspot.com",
        messagingSenderId: "754456726342",
        appId: "1:754456726342:web:bfa971473689237a873347"
        };
      
        // Initialize Firebase„ÅÆÂàùÊúüÂåñ
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        //‰ª•‰∏ã „Éá„Éº„Çø„Éô„Éº„Çπ„Åã„Çâ„ÅÆÊÉÖÂ†±Áç≤Âæó„Å®Ë°®Á§∫
        window.addEventListener('DOMContentLoaded', () => {
        // „É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„ÅÆÂ§âÊõ¥„ÇíÁõ£Ë¶ñ
        onAuthStateChanged(auth, (user) => {
         if (user) {
        const userId = user.uid;
        console.log(userId);

        const userRef = ref(db, `users/${userId}`);

        // „Éá„Éº„Çø„ÅÆÂèñÂæó„Å®Ë°®Á§∫
        onValue(userRef, (snapshot) => {
        const data = snapshot.val();
        // „Éá„Éº„Çø„ÇíÊäïÁ®ø„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
        const groupedData = groupDataById(data);
        // „Ç∞„É´„Éº„ÉóÂåñ„Åï„Çå„Åü„Éá„Éº„Çø„ÇíË°®Á§∫
        displayGroupedData(groupedData);
         });
        } else {
        // „É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅÆÂá¶ÁêÜ
        console.log('User is not logged in.');
        }
        });
        });

    // „Éá„Éº„Çø„ÇíÊäïÁ®ø„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ„Åô„ÇãÈñ¢Êï∞
    function groupDataById(data) {
        const groupedData = {};
        for (const key in data) {
        if (Object.hasOwnProperty.call(data, key)) {
        const item = data[key];
        const postId = key; // ÊäïÁ®øID„ÇíÂèñÂæó
        if (groupedData[postId]) {
        groupedData[postId].push(item);
        } else {
        groupedData[postId] = [item];
         }
        }
        }
        return groupedData;
     }

    // „Ç∞„É´„Éº„ÉóÂåñ„Åï„Çå„Åü„Éá„Éº„Çø„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
    function displayGroupedData(groupedData) {
         const containerElement = document.getElementById    ('container');
        containerElement.innerHTML = ''; // „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢

        // ÊäïÁ®ø„Åî„Å®„Å´ÈÄÜÈ†Ü„ÅßË°®Á§∫„Åô„Çã„Åü„ÇÅ„Å´„ÄÅÊäïÁ®øID„ÅÆÈÖçÂàó„ÇíÈÄÜÈ†Ü„Å´„ÇΩ„Éº„Éà
        const postIds = Object.keys(groupedData).sort().reverse();

        postIds.forEach((postId) => {
        if (Object.hasOwnProperty.call(groupedData, postId)) {
        const items = groupedData[postId];

        const postElement = document.createElement('div');
         const postBodyElement = document.createElement('div');

        items.forEach((item) => {
        const itemId = item.id;
        const date = item.date;
        const title = item.title;
        const result = item.result;
        const dekigoto = item.dekigoto;
        const riyu = item.riyu;

        const itemContainerElement = document.createElement('div');
        itemContainerElement.id = `item-${itemId}`; // ID„ÇíË®≠ÂÆö
        itemContainerElement.classList.add('item-container'); // „ÇØ„É©„ÇπÂêç„ÇíËøΩÂä†

        const dateElement = document.createElement('div');
        dateElement.classList.add('date'); // „ÇØ„É©„ÇπÂêç„ÇíËøΩÂä†
        dateElement.textContent = date;
        itemContainerElement.appendChild(dateElement);

        const titleElement = document.createElement('div');
        titleElement.textContent = title;
        itemContainerElement.appendChild(titleElement);

        const resultElement = document.createElement('div');
        resultElement.classList.add('result'); // „ÇØ„É©„ÇπÂêç„ÇíËøΩÂä†
        resultElement.textContent = result;
        itemContainerElement.appendChild(resultElement);

        const dekigotoElement = document.createElement('div');
        dekigotoElement.textContent = dekigoto;
        dekigotoElement.style.display = 'none'; // ÂàùÊúüÁä∂ÊÖã„Åß„ÅØÈùûË°®Á§∫
        itemContainerElement.appendChild(dekigotoElement);

        const riyuElement = document.createElement('div');
        riyuElement.textContent = riyu;
        riyuElement.style.display = 'none'; // ÂàùÊúüÁä∂ÊÖã„Åß„ÅØÈùûË°®Á§∫
        itemContainerElement.appendChild(riyuElement);

        // ÁµêÊûú„Å´„Çà„Å£„Å¶ËÉåÊôØËâ≤„ÇíË®≠ÂÆö
        const backgroundColor = getColorByResult(result);
        if (backgroundColor) {
          itemContainerElement.style.backgroundColor = backgroundColor;
        }

        // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÅÆËøΩÂä†
        titleElement.addEventListener('click', () => {
          dekigotoElement.style.display = 'block'; // Âá∫Êù•‰∫ã„ÇíË°®Á§∫
        });

        resultElement.addEventListener('click', () => {
          riyuElement.style.display = 'block'; // ÁêÜÁî±„ÇíË°®Á§∫
        });

        postBodyElement.prepend(itemContainerElement); // ÊäïÁ®ø„Åî„Å®„ÅÆË¶ÅÁ¥†„ÇíÊäïÁ®ø„Ç®„É™„Ç¢„ÅÆÂÖàÈ†≠„Å´ËøΩÂä†
         });

        // ÊäïÁ®ø„Ç®„É™„Ç¢„Çí„Ç≥„É≥„ÉÜ„Éä„Å´ËøΩÂä†
        postElement.appendChild(postBodyElement);
        containerElement.appendChild(postElement);
        }
     });
    }


    // ÁµêÊûú„Å´„Çà„Å£„Å¶ËÉåÊôØËâ≤„ÇíËøî„ÅôÈñ¢Êï∞
    function getColorByResult(result) {
    const colors = { 
            'Âñú„Å≥':'#fffa71',
            'ÊÑõ':'#d4fb4f',
            'ÁΩ™ÊÇ™ÊÑü':'#9bc163',
            'Ê≠ìÂñú':'#76fa62',
            '‰∏çÂÅ•Â∫∑':'#9a9750',
            'Ëá™Â∞äÂøÉ':'#eabf93',
            'Ê•ΩË¶≥':'#fbedbc',
            '„Åª„ÇçËã¶„Åï':'#b59e79',
            '‰ø°È†º':'#8ff971',
            'ÊúçÂæì':'#59c13b',
            'Â•ΩÂ•áÂøÉ':'#72fac0',
            'ËëõËó§':'#5b88bf',
             'ÊîØÈÖç':'#b3c13c',
            'Â∏åÊúõ' :'#dbfb52',
            'ÊÑüÂÇ∑ÁöÑ':'#68c4eb',
             'ÊÅê„Çå':'#62cf68',
            'ÁïèÊÄñ':'#61d18f',
            'ÁæûÊÅ•ÂøÉ':'#4d79f3',
            'ÂÜ∑Ê∑°':'#928dab',
            'Êá∏Âøµ' :'#ddeb54',
            'Áµ∂Êúõ':'#43a0e2',
            'È©ö„Åç':'#6df2ef',
            '‰∏ç‰ø°ÊÑü':'#9aa2c9',
            'ÊÜ§ÊÖ®':'#eb3478',
            'Ê∑∑‰π±':'#b9939e',
            'ÊãíÁµ∂':'#768fca',
            'ÊÇ≤„Åó„Åø':'#749dfa',
            'ÂæåÊÇî' :'#dabaf9',
            'Â´âÂ¶¨':'#d17aee',
            'ÊÇ≤Ë¶≥ÁöÑ':'#e4bee3',
            'Â´åÊÇ™':'#9a6af0',
            'ËªΩËîë':'#cfa3aa',
            'ÁöÆËÇâ':'#d397ca',
            'ÊÄí„Çä':'#ec616a',
            'ÊîªÊíÉÊÄß':'#d6764f',
            'ÊúüÂæÖ':'#f1996b'
        };
        return colors[result] || null;
        }  

// ‰ª•‰∏ãÁµêÊûú„ÅÆ‰∏¶„Å≥Êõø„Åà„Å´„Å§„ÅÑ„Å¶
// üü°Âè§„ÅÑÈ†Ü„ÅÆÊñπ„Åå„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Å´„Å™„Çã‰ª∂„ÅØ„Åæ„Å†Êú™Ëß£Ê±∫

// „Éú„Çø„É≥Ë¶ÅÁ¥†„ÅÆÂèñÂæó
const emotionButton = document.getElementById('f_change');
const dateButton = document.getElementById('r_change');

// ‰∏¶„Å≥Êõø„ÅàÁä∂ÊÖã„ÅÆÁÆ°ÁêÜÁî®„Éï„É©„Ç∞
let isSortedByEmotion = false;
let isSortedByDate = false;

// ÊÑüÊÉÖ„Åß‰∏¶„Å≥Êõø„Åà„Çã„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
emotionButton.addEventListener('click', () => {
  const containerElement = document.getElementById('container');
  const items = [...containerElement.getElementsByClassName('item-container')];

  // ÊÑüÊÉÖ„Åß„ÅÆ‰∏¶„Å≥Êõø„Åà
  items.sort((a, b) => {
    const resultA = a.getElementsByClassName('result')[0].textContent;
    const resultB = b.getElementsByClassName('result')[0].textContent;
    return resultA.localeCompare(resultB);
  });

  if (isSortedByEmotion) {
    // ÈÄÜÈ†Ü„Å´‰∏¶„Å≥Êõø„Åà
    items.reverse();
  }

  isSortedByEmotion = !isSortedByEmotion;
  isSortedByDate = false;

  // „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢
  containerElement.innerHTML = '';
  items.forEach((item) => {
    containerElement.appendChild(item);
  });
});

// Âè§„ÅÑÈ†Ü„Å´‰∏¶„Å≥Êõø„Åà„Çã„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
dateButton.addEventListener('click', () => {
  const containerElement = document.getElementById('container');
  const items = [...containerElement.getElementsByClassName('item-container')];

  // ÊäïÁ®øID„ÇíÂèñÂæó„Åó„Å¶‰∏¶„Å≥Êõø„Åà
  items.sort((a, b) => {
    const postIdA = a.getAttribute('data-post-id');
    const postIdB = b.getAttribute('data-post-id');
    return postIdA - postIdB;
  });

  if (isSortedByDate) {
    // ÂÖÉ„ÅÆ‰∏¶„Å≥È†Ü„Å´Êàª„Åô
    items.reverse();
  }

  isSortedByDate = !isSortedByDate;
  isSortedByEmotion = false;

  // „Ç≥„É≥„ÉÜ„ÉäË¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢
  containerElement.innerHTML = '';
  items.forEach((item) => {
    containerElement.appendChild(item);
  });
});





    </script> 
</body>
</html>